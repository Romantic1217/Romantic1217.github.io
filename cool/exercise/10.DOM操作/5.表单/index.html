<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>表单</title>
	<style type="text/css">
		td{
			text-align: center;
		}
		th input{
			width: 20px;
			height: 20px;
		}
		td input{
			width: 20px;
			height: 20px;
		}
		a{
			text-decoration: none;
			padding-left: 10px;
		}
	</style>
	<script type="text/javascript">
	var datas = [
            {
                id: 1,
                username: '玛利亚',
                age: 36,
                sex: '女'
            },
            {
                id: 2,
                username: '迈克尔',
                age: 30,
                sex: '男'
            },
            {
                id: 3,
                username: '隔壁老王',
                age: 17,
                sex: '男'
            },
            {
                id: 4,
                username: '旺财',
                age: 22,
                sex: '未知'
            },
            {
                id: 5,
                username: '托尼',
                age: 26,
                sex: '男'
            }
        ];
	</script>
</head>
<body>
	姓名：<input type="text" />
	年龄：<input type="text" />
	性别：<input type="text" />
	<button>提交</button>
	<br />
	<br />
	排序：
	<select name="" id="">
		<option>编号</option>
		<option>年龄</option>
	</select>
	<select name="" id="">
		<option>降序</option>
		<option>升序</option>
	</select>
	<button>提交</button>
	<br />
	<br />
	搜索：<input type="text" />			
	<button>提交</button>
	<br />
	<br />
	<input type="button" value="反选" id="btn"/>
	<input type="button" value="批量删除" id="remove"/>
	<br />
	<br />
	<table width="100%" border="1" id="tab">
		<thead>
			<th><input type="checkbox" id="ischeckAll" />全选</th>
			<th>编号</th>
			<th>年龄</th>
			<th>姓名</th>
			<th>性别</th>
			<th>操作</th>
		</thead>
		<tbody>
		</tbody>
	</table>
	<script type="text/javascript">
		/*需求
	           1.填写表单，点击添加按钮，把表单中数据动态添加到表格中
	           2.自动生成编号（自增长）
	           3.隔行变色，注意：新加数据也要隔行变色 css/js各一套
	           4.删除指定行
			         编号不变
			          隔行变色
	    */
	  	var tab = document.getElementById('tab');//获取table
		var tbody = tab.tBodies[0];//获取table下的tbody
		var all = document.getElementById('ischeckAll');
		var trs = tbody.getElementsByTagName('tr');
		var checkboxs = tbody.getElementsByTagName('input');//获取tbody的
		var btn = document.getElementById('btn');
		var remove = document.getElementById('remove');
		var inps = document.getElementsByTagName('input');
		var btns = document.getElementsByTagName('button');
		var selects = document.getElementsByTagName('select');
		var dataLen = datas.length;
		//搜索
		
		//排序
		btns[1].onclick = function(){
			//改变指向
			var eles = [].slice.call(trs);
			var index;
			
			if( selects[0].value == '编号' ){
				index = 1;
			}else{
				index = 3;
			}
			//下拉框排序
			eles.sort(function(a,b){
				a = a.children[index].innerHTML;
				b = b.children[index].innerHTML;
				
				if( selects[1].value == '升序' ){
					return a-b;   //从小到大
				}else{
					return b-a;
				}
			});
			for( var i=0;i<eles.length;i++ ){
				tbody.appendChild(eles[i]);
			}
		}
		//创建tr，当没有内容的时候就终止。
		btns[0].onclick = function(){
			for( var i=0;i<3;i++ ){
				if( inps[i].value == '' ){
					alert('请输入内容！！！');
					return;
				}
			}
			//创建数据
			var obj = {
				id: ++dataLen,//先++再赋值
				username: inps[0].value,
				age: inps[1].value,
				sex: inps[2].value
			};
			//把数据存起来
			datas.push(obj);
			//显示行
			createTR([obj]);
			//调用隔行变色
			colorChange(trs);
			//取消全选
			all.checked = false;
		}
		//批量删除
		remove.onclick = function(){
			for( var i=0;i<checkboxs.length;i++ ){
				//删除对应的数据
				if( checkboxs[i].checked ){
					removedatas(trs[i].children[i].innerHTML);
					tbody.removeChild(trs[i]);
					i--;
				}
			}
			//tr的长度等不等于0时真的，那么all的checked就为false
			if( trs.length == 0 ){
				all.checked = false;
			}
			colorChange(trs);
		}
		//反选
		btn.onclick = function(){
			for( var i=0;i<checkboxs.length;i++ ){
				checkboxs[i].checked =	!checkboxs[i].checked;
				checkboxs[i].onchange();
			}
		}
		//全选
		all.onchange = function(){
			//循环tbody里面的checkboxs
			for(var i=0;i<checkboxs.length;i++){
				checkboxs[i].checked = this.checked;
				if(this.checked){
					trs[i].style.background = 'red';
				}else{
					colorChange(trs);
				}
			}
		}
		createTR(datas);//把datas传入里面
		colorChange(trs);
		//实现隔行变色
		function colorChange(trs){
			for( var i=0;i<trs.length;i++  ){
				//tr跳出当前的循环
				if( checkboxs[i].checked ){
					continue;
				}
				if( i%2 == 0 ){
					trs[i].style.background = 'green';
				}else{
					trs[i].style.background = 'yellow';
				}
			}
		}
		//创建tr。
		function createTR(data){
			for( var i=0;i<data.length;i++ ){
				var row = document.createElement('tr');
				tbody.appendChild(row);
				createTD(data[i],row);//遍历到数组里面的每一个
			}
		};
		//创建td
		function createTD(data,row){
			var td = document.createElement('td');
			var checkbox1 = document.createElement('input');
			checkbox1.type = 'checkbox';
			td.appendChild(checkbox1);
			//单选设置高亮
			checkbox1.onchange = function(){
				if(this.checked){
					row.style.background = 'red';
				}else{
					row.style.background = '';
				}
				colorChange(trs);
				all.checked = ischeckedAll();
			};
			row.appendChild(td);
			//根据数据生成中间的td
			for( var attr in data ){
				//中间对应的td
				td = document.createElement('td');
				td.innerHTML = data[attr];//创建td的内容等于datas的任意一个
				row.appendChild(td);//把td放到tr里面
			}
			//创建操作的td
			td = document.createElement('td');
			//创建td里面的a，声明变量
			var up = document.createElement('a');
			var down = document.createElement('a');
			var remove = document.createElement('a');
			up.href = down.href = remove.href = "javascript:;";
			up.innerHTML = '上移';
			down.innerHTML = '下移';
			remove.innerHTML = '删除';
			//点击上移
			up.onclick = function(){
				if( row.previousElementSibling ){
					tbody.insertBefore(row,row.previousElementSibling);
				}else{
					alert('已经是第一个了！！！');
				}
				colorChange(trs);
			}
			//点击下移
			down.onclick = function(){
				if(row.nextElementSibling){
					tbody.insertBefore(row.nextElementSibling,row);
				}else{
					alert('这是最后一个啦啦啦！！！');
				}
				colorChange(trs);
			}
			remove.onclick = function(){
				tbody.removeChild(row);
				//删除对应数据
				removedatas(data.id);
				//调用单行设置高亮
				checkbox1.onchange();
				colorChange(trs);
			}
			//点击删除，删除当前的tr
			//把a放入td里面
			td.appendChild(up);
			td.appendChild(down);
			td.appendChild(remove);
			row.appendChild(td);
			tbody.appendChild(row);
		};
		//判断是否全选
		function ischeckedAll(){
			for( var i=0;i<checkboxs.length;i++ ){
				if( !checkboxs[i].checked ){//默认样式选中
					return false;
				}
			}
			return true;
		}
		//删除数据
		function removedatas(id){
			//循环datas的长度
			for( var i=0;i<datas.length;i++ ){
				if( datas[i].id == id ){
					datas.splice(i,1);
				}
			}
		}
	</script>
</body>
</html>
